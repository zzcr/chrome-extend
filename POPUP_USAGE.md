# OpenTiny NEXT 扩展弹窗功能使用说明

## 功能概述

为OpenTiny NEXT Chrome扩展添加了点击图标弹出popup弹窗的功能，弹窗中包含可定制的菜单系统，以及浏览器右侧的抽屉面板（侧边栏）功能。

## 新增文件

1. **src/popup.html** - 弹窗界面结构
2. **src/popup.css** - 弹窗样式设计
3. **src/popup.js** - 弹窗交互逻辑和菜单管理
4. **src/sidepanel.html** - 侧边栏界面结构
5. **src/sidepanel.css** - 侧边栏样式设计
6. **src/sidepanel.js** - 侧边栏交互逻辑和功能管理
7. **manifest.json** - 更新了action和sidePanel配置

## 功能特性

### 1. 快速操作

- **改变背景色**：随机更改当前页面的背景颜色
- **打开侧边栏**：打开浏览器右侧的抽屉面板
- **设置**：打开扩展设置页面

### 2. 自定义菜单系统

- **添加菜单项**：点击 + 按钮可以添加自定义菜单项
- **菜单类型**：
  - 改变页面颜色
  - 导出数据（JSON格式）
  - 打开网址
  - 执行自定义脚本
- **菜单管理**：可以编辑和删除已添加的菜单项

### 3. 侧边栏功能

- **快速工具**：改变背景、导出数据
- **页面信息**：显示当前页面的标题、网址、状态
- **自定义功能**：添加和执行自定义脚本、样式、数据处理
- **操作历史**：记录最近的操作历史
- **实时反馈**：操作结果实时显示

### 4. 界面特性

- 现代化渐变设计
- 响应式布局
- 动画效果
- 状态指示器
- 通知系统

## 使用方法

### 基本使用

1. 点击Chrome工具栏中的OpenTiny NEXT扩展图标
2. 弹窗会自动显示，包含快速操作和自定义菜单
3. 点击快速操作按钮即可执行相应功能
4. 点击"打开侧边栏"按钮可以打开浏览器右侧的抽屉面板

### 自定义菜单

1. 点击弹窗中的 + 按钮
2. 填写菜单标题和选择执行动作
3. 根据动作类型填写相应参数（如网址、脚本代码）
4. 点击保存按钮
5. 新菜单项会出现在自定义菜单列表中
6. 点击菜单项可以执行相应操作
7. 点击删除按钮可以移除菜单项

### 侧边栏使用

1. 点击弹窗中的"打开侧边栏"按钮
2. 侧边栏会在浏览器右侧打开
3. 使用快速工具进行页面操作（改变背景、导出数据）
4. 查看页面信息和操作历史
5. 添加和执行自定义功能

## 技术实现

### 消息通信

- popup与content script通过chrome.runtime.onMessage进行通信
- 支持异步消息处理
- 包含错误处理和用户反馈

### 数据存储

- 使用chrome.storage.local存储自定义菜单项
- 数据持久化保存
- 支持动态加载和保存

### 安全考虑

- 自定义脚本执行有安全过滤
- 输入验证和HTML转义
- 错误处理和用户提示

## 文件结构

```text
src/
├── popup.html          # 弹窗HTML结构
├── popup.css           # 弹窗样式
├── popup.js            # 弹窗逻辑
├── sidepanel.html      # 侧边栏HTML结构
├── sidepanel.css       # 侧边栏样式
├── sidepanel.js        # 侧边栏逻辑
├── main.js             # 更新了消息监听
├── service_worker.js   # 更新了侧边栏行为
└── manifest.json       # 更新了action和sidePanel配置
```

## 注意事项

1. 确保Chrome扩展已正确加载
2. 某些功能需要在支持的网页上才能正常工作
3. 自定义脚本执行有安全限制
4. 导出的数据会保存为JSON文件

## 版本信息

- 当前版本：1.0.0
- 更新日期：2024年
- 兼容性：Chrome Manifest V3
